# SHARED YAML STRUCUTRE
_dtypes_train: &dtypes_train
  renta: float32
  ind_ahor_fin_ult1: UInt8
  ind_aval_fin_ult1: UInt8
  ind_cco_fin_ult1: UInt8
  ind_cder_fin_ult1: UInt8
  ind_cno_fin_ult1: UInt8
  ind_ctju_fin_ult1: UInt8
  ind_ctma_fin_ult1: UInt8
  ind_ctop_fin_ult1: UInt8
  ind_ctpp_fin_ult1: UInt8
  ind_deco_fin_ult1: UInt8
  ind_deme_fin_ult1: UInt8
  ind_dela_fin_ult1: UInt8
  ind_ecue_fin_ult1: UInt8
  ind_fond_fin_ult1: UInt8
  ind_hip_fin_ult1: UInt8
  ind_plan_fin_ult1: UInt8
  ind_pres_fin_ult1: UInt8
  ind_reca_fin_ult1: UInt8
  ind_tjcr_fin_ult1: UInt8
  ind_valo_fin_ult1: UInt8
  ind_viv_fin_ult1: UInt8
  ind_nomina_ult1: UInt8
  ind_nom_pens_ult1: UInt8
  ind_recibo_ult1: UInt8

_dtypes_shared: &dtypes_shared
  ncodpers: int32
  indrel: UInt8
  ind_actividad_cliente: UInt8

# INPUT
santander_train_input:
  type: pandas.CSVDataSet
  filepath: data/01_raw/santander/train_ver2.csv
  layer: raw
  load_args:
    dtype:
      <<: *dtypes_shared
      tipodom: UInt8
      segmento: category
      sexo: category
      ind_nuevo: category
      ult_fec_cli_1t: category
      indext: category
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

santander_test_input:
  type: pandas.CSVDataSet
  filepath: data/01_raw/santander/test_ver2.csv
  layer: raw
  load_args:
    dtype:
      <<: *dtypes_shared
      tipodom: UInt8
      segmento: category
      sexo: category
      ind_nuevo: category
      ult_fec_cli_1t: category
      indext: category
    chunksize: 1000000
    low_memory: False

# SAMPLE
santander_preprocessing_train.santander_sample:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_train_sample.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      tipodom: UInt8
      segmento: category
      sexo: category
      ind_nuevo: category
      ult_fec_cli_1t: category
      indext: category
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

santander_preprocessing_test.santander_sample:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_test_sample.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    chunksize: 1000000
    low_memory: False

# FILTERING
santander_preprocessing_train.santander_filtered:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_filtered_train.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      segmento: category
      sexo: category
      ind_nuevo: category
      ult_fec_cli_1t: category
      indext: category
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

santander_preprocessing_test.santander_filtered:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_filtered_test.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    chunksize: 1000000
    low_memory: False

# CLEANING
santander_preprocessing_train.santander_cleaned:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_cleaned_train.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      segmento: category
      sexo: category
      ind_nuevo: category
      ult_fec_cli_1t: category
      indext: category
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

santander_preprocessing_test.santander_cleaned:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_cleaned_test.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    chunksize: 1000000
    low_memory: False

# SPLITTING
santander_preprocessing_train.santander_pre_train:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_pre_train.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      sexo: str
      indext: str
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

santander_preprocessing_train.santander_pre_val:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_pre_val.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      sexo: str
      indext: category
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

# IMPUTING
santander_train:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_train.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      segmento: category
      ind_nuevo: category
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

santander_val:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_val.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      segmento: category
      ind_nuevo: category
      <<: *dtypes_train
    chunksize: 1000000
    low_memory: False

santander_test:
  type: pandas.CSVDataSet
  filepath: data/02_intermediate/santander/santander_test.csv
  layer: intermediate
  save_args:
    index: False
  load_args:
    dtype:
      <<: *dtypes_shared
      renta: float32
      segmento: category
      ind_nuevo: category
    chunksize: 1000000
    low_memory: False

# ACT
santander_articles:
  type: pandas.CSVDataSet
  filepath: data/03_primary/santander/santander_articles.csv
  layer: primary
  save_args:
    index: False
  load_args:
    dtype:
      article_id: str
    low_memory: False

santander_customers:
  type: pandas.CSVDataSet
  filepath: data/03_primary/santander/santander_customers.csv
  layer: primary
  save_args:
    index: False
  load_args:
    dtype:
      customer_id: int32
      indrel: UInt8
      ind_actividad_cliente: UInt8
      renta: float32
      segmento: category
      ind_nuevo: category
      <<: *dtypes_train
    low_memory: False

santander_transactions_train:
  type: pandas.CSVDataSet
  filepath: data/03_primary/santander/santander_transactions_train.csv
  layer: primary
  save_args:
    index: False
  load_args:
    dtype:
      article_id: str
      customer_id: int32
    chunksize: 1000000
    low_memory: False

santander_transactions_val:
  type: pandas.CSVDataSet
  filepath: data/03_primary/santander/santander_transactions_val.csv
  layer: primary
  save_args:
    index: False
  load_args:
    dtype:
      article_id: str
      customer_id: int32
    chunksize: 1000000
    low_memory: False

# GRAPH RECOMMENDATION
santander.transactions_graph:
  type: pandas.CSVDataSet
  filepath: data/03_primary/santander/santander_transactions_graph.csv
  layer: primary
  save_args:
    index: False
  load_args:
    dtype:
      item_id: str
      user_id: int32
    chunksize: 1000000
    low_memory: False

santander_transactions_mapped:
  type: pandas.CSVDataSet
  filepath: data/03_primary/santander/santander_transactions_mapped.csv
  layer: primary
  save_args:
    index: False
  load_args:
    chunksize: 1000000
    low_memory: False

santander_users_mapping:
  type: pickle.PickleDataSet
  filepath: data/03_primary/santander/santander_users_mapping.pickle
  layer: primary
  backend: pickle

santander_items_mapping:
  type: pickle.PickleDataSet
  filepath: data/03_primary/santander/santander_items_mapping.pickle
  layer: primary
  backend: pickle

#DGSR

##train_val_test
santander_dgsr_train_val_test_grm_transactions_graph:
  type: pickle.PickleDataSet
  filepath: data/04_feature/santander/santander_dgsr_train_val_test_grm_transactions_graph.pickle
  layer: feature
  backend: pickle

santander_dgsr_train_val_test_grm_negative_transactions_samples:
  type: pickle.PickleDataSet
  filepath: data/03_primary/santander/santander_dgsr_train_val_grm_test_negative_transactions_samples.pickle
  layer: primary

santander_dgsr_train_val_test_grm_train_graphs:
  type: recommender_gnn.extras.datasets.graph_dataset.DGSRSubGraphsDataSet
  dir: data/05_model_input/santander/santander_dgsr_train_val_test_grm_train_graphs
  layer: model_input
  save_args:
    file_extension: bin

santander_dgsr_train_val_test_grm_val_graphs:
  type: recommender_gnn.extras.datasets.graph_dataset.DGSRSubGraphsDataSet
  dir: data/05_model_input/santander/santander_dgsr_train_val_test_grm_val_graphs
  layer: model_input
  save_args:
    file_extension: bin

santander_dgsr_train_val_test_grm_test_graphs:
  type: recommender_gnn.extras.datasets.graph_dataset.DGSRSubGraphsDataSet
  dir: data/05_model_input/santander/santander_dgsr_train_val_test_grm_test_graphs
  layer: model_input
  save_args:
    file_extension: bin


##Kaggle
santander_dgsr_kaggle_grm_transactions_graph:
  type: pickle.PickleDataSet
  filepath: data/04_feature/santander/santander_dgsr_kaggle_grm_transactions_graph.pickle
  layer: feature
  backend: pickle

santander_dgsr_kaggle_grm_negative_transactions_samples:
  type: pickle.PickleDataSet
  filepath: data/03_primary/santander/santander_dgsr_kaggle_grm_negative_transactions_samples.pickle
  layer: primary

santander_dgsr_kaggle_grm_train_graphs:
  type: recommender_gnn.extras.datasets.graph_dataset.DGSRSubGraphsDataSet
  dir: data/05_model_input/santander/santander_dgsr_kaggle_grm_train_graphs
  layer: model_input
  save_args:
    file_extension: bin

santander_dgsr_kaggle_grm_val_graphs:
  type: recommender_gnn.extras.datasets.graph_dataset.DGSRSubGraphsDataSet
  dir: data/05_model_input/santander/santander_dgsr_kaggle_grm_val_graphs
  layer: model_input
  save_args:
    file_extension: bin

santander_dgsr_kaggle_grm_test_graphs:
  type: recommender_gnn.extras.datasets.graph_dataset.DGSRSubGraphsDataSet
  dir: data/05_model_input/santander/santander_dgsr_kaggle_grm_test_graphs
  layer: model_input
  save_args:
    file_extension: bin

santander_dgsr_kaggle_grm_predict_graphs:
  type: recommender_gnn.extras.datasets.graph_dataset.DGSRSubGraphsDataSet
  dir: data/05_model_input/santander/santander_dgsr_kaggle_grm_predict_graphs
  layer: model_input
  save_args:
    file_extension: bin

santander_dgsr_kaggle_gr_model:
  type: kedro_mlflow.io.artifacts.MlflowArtifactDataSet
  layer: model
  data_set:
    type: pickle.PickleDataSet
    filepath: data/06_models/santander/santander_dgsr_kaggle_trained_model.pkl

santander_dgsr_kaggle_gr_predictions:
  type: pandas.CSVDataSet
  filepath: data/07_model_output/santander/santander_dgsr_kaggle_gr_predictions.csv
  layer: model_output
  save_args:
    index: False
  load_args:
    chunksize: 1000000
    low_memory: False

santander_submission:
  type: pandas.CSVDataSet
  filepath: data/07_model_output/santander/santander_submission.csv
  layer: model_output
  save_args:
    index: False
  load_args:
    chunksize: 1000000
    low_memory: False

test_gpu_pickle:
  type: pickle.PickleDataSet
  filepath: gs://gid-ml-framework-data/06_models/test_gpu.pkl
  layer: model